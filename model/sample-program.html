
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Anatomy of a DPC++ Program &#8212; DPC++ Reference  documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="../_static/custom.js"></script>
    <link rel="shortcut icon" href="../_static/favicons.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Platform Model" href="platform-model.html" />
    <link rel="prev" title="Programming Model" href="index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/oneAPI-rgb-rev-100.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">DPC++ Reference  documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Programming Model
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Anatomy of a DPC++ Program
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="platform-model.html">
     Platform Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="execution-model.html">
     Execution Model
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="memory-model.html">
     Memory Model
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="memory-objects.html">
       Memory Objects
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="accessors.html">
       Accessors
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="synchronization.html">
       Synchronization
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="unified-shared-memory.html">
       Unified Shared Memory
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="memory-types.html">
       Memory Types
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="kernel-programming-model.html">
     Kernel Programming Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="error-handling.html">
     Error Handling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="fall-back.html">
     Fall Back
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../dpcpp-index.html">
   Interface
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../header-file.html">
     Header File
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../namespaces.html">
     Namespaces
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../common.html">
     Common Interface
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/common-byval.html">
       By-value Semantics
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/common-reference.html">
       Reference Semantics
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/properties.html">
       property_list
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/param_traits.html">
       param_traits
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../runtime.html">
     Runtime Classes
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/device-selector.html">
       Device selectors
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/platform.html">
       Platforms
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/context.html">
       Contexts
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/device.html">
       Devices
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/queue.html">
       Queues
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/event.html">
       Events
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../data.html">
     Data access
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/buffer.html">
       Buffers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/image.html">
       Images
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../iface/accessors.html">
       Accessors
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
      <label for="toctree-checkbox-7">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../iface/buffer-accessor.html">
         sycl::accessor (buffer)
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../iface/local-accessor.html">
         sycl::accessor (local memory)
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../iface/image-accessor.html">
         sycl::accessor (image)
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../iface/accessor-enums.html">
         sycl::access::mode
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/address-space.html">
       Multipointer
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/private_memory.html">
       sycl::private_memory
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/sampler.html">
       Samplers
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../usm.html">
     Unified shared memory (USM)
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/usm-malloc.html">
       sycl::malloc_device
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/usm_allocator.html">
       sycl::usm_allocator
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/usm.html">
       sycl::usm::alloc
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../parallelism.html">
     Expressing parallelism
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/range.html">
       sycl::range
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/group.html">
       sycl::group
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/id.html">
       sycl::id
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/item.html">
       sycl::item
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/h_item.html">
       sycl::h_item
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/nd_item.html">
       sycl::nd_item
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/nd_range.html">
       sycl::nd_range
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/device-event.html">
       sycl::device_event
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/command-group.html">
       Command groups
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/command-group-handler.html">
       Invoking kernels
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/kernel.html">
       Kernels
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/program.html">
       Programs
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../error.html">
     Error handling
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
    <label for="toctree-checkbox-10">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/exception.html">
       Exceptions
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../data-types.html">
     Data types
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
    <label for="toctree-checkbox-11">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/scalar-types.html">
       Scalar types
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/vector-types.html">
       Vector types
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../synchronization.html">
     Synchronization and atomics
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
    <label for="toctree-checkbox-12">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/types.html">
       Synchronization types
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../io.html">
     IO
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
    <label for="toctree-checkbox-13">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../iface/stream.html">
       Streams
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../glossary.html">
   Glossary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../notices.html">
   Notices and Disclaimers
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/model/sample-program.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        
        <a class="issues-button"
            href="https://github.com/oneapi-src/DPCPP_Reference/issues/new?title=Issue%20on%20page%20%2Fmodel/sample-program.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/oneapi-src/DPCPP_Reference/edit/dpcpp/source/model/sample-program.rst"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <section id="anatomy-of-a-dpc-program">
<span id="sample-program"></span><h1>Anatomy of a DPC++ Program<a class="headerlink" href="#anatomy-of-a-dpc-program" title="Permalink to this headline">¶</a></h1>
<p>We start with a DPC++ example application to illustrate basic DPC++
concepts. We continue by breaking down the DPC++ programming model
into 4 areas as follows.</p>
<p>The following example uses the oneAPI programming model to add 2
vectors. When compiled and executed, the sample program computes the
1024 element vector add in parallel on the accelerator. This assumes
the accelerator has multiple compute elements capable of executing in
parallel.  This sample illustrates the models that software
developers need to employ in their program. We identify sections
of code by line number and discuss their role, highlighting their
relation to the programming and execution models.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This sample code is intended to illustrate the models that comprise
the oneAPI program model; it is not intended to be a typical
program.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">#include &lt;CL/sycl.hpp&gt;</span>
<span class="linenos"> 2</span><span class="n">using</span> <span class="n">namespace</span> <span class="n">sycl</span><span class="p">;</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="n">const</span> <span class="nb">int</span> <span class="n">SIZE</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="n">void</span> <span class="n">show_platforms</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos"> 7</span>  <span class="n">auto</span> <span class="n">platforms</span> <span class="o">=</span> <span class="n">platform</span><span class="p">::</span><span class="n">get_platforms</span><span class="p">();</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>  <span class="k">for</span> <span class="p">(</span><span class="n">auto</span> <span class="o">&amp;</span><span class="n">platform</span> <span class="p">:</span> <span class="n">platforms</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">10</span>    <span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Platform: &quot;</span>
<span class="linenos">11</span>	      <span class="o">&lt;&lt;</span> <span class="n">platform</span><span class="o">.</span><span class="n">get_info</span><span class="o">&lt;</span><span class="n">info</span><span class="p">::</span><span class="n">platform</span><span class="p">::</span><span class="n">name</span><span class="o">&gt;</span><span class="p">()</span>
<span class="linenos">12</span>	      <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">13</span>
<span class="linenos">14</span>    <span class="n">auto</span> <span class="n">devices</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">get_devices</span><span class="p">();</span>
<span class="linenos">15</span>    <span class="k">for</span> <span class="p">(</span><span class="n">auto</span> <span class="o">&amp;</span><span class="n">device</span> <span class="p">:</span> <span class="n">devices</span> <span class="p">)</span> <span class="p">{</span>
<span class="linenos">16</span>      <span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;  Device: &quot;</span>
<span class="linenos">17</span>		<span class="o">&lt;&lt;</span> <span class="n">device</span><span class="o">.</span><span class="n">get_info</span><span class="o">&lt;</span><span class="n">info</span><span class="p">::</span><span class="n">device</span><span class="p">::</span><span class="n">name</span><span class="o">&gt;</span><span class="p">()</span>
<span class="linenos">18</span>		<span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">19</span>    <span class="p">}</span>
<span class="linenos">20</span>  <span class="p">}</span>
<span class="linenos">21</span><span class="p">}</span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="n">void</span> <span class="n">vec_add</span><span class="p">(</span><span class="nb">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="nb">int</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="nb">int</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">24</span>  <span class="nb">range</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">a_size</span><span class="p">{</span><span class="n">SIZE</span><span class="p">};</span>
<span class="linenos">25</span>
<span class="linenos">26</span>  <span class="n">buffer</span><span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span> <span class="n">a_buf</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_size</span><span class="p">);</span>
<span class="linenos">27</span>  <span class="n">buffer</span><span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span> <span class="n">b_buf</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a_size</span><span class="p">);</span>
<span class="linenos">28</span>  <span class="n">buffer</span><span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span> <span class="n">c_buf</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a_size</span><span class="p">);</span>
<span class="linenos">29</span>
<span class="linenos">30</span>  <span class="n">queue</span> <span class="n">q</span><span class="p">;</span>
<span class="linenos">31</span>
<span class="linenos">32</span>  <span class="n">q</span><span class="o">.</span><span class="n">submit</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="n">handler</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">33</span>      <span class="n">auto</span> <span class="n">c_res</span> <span class="o">=</span> <span class="n">c_buf</span><span class="o">.</span><span class="n">get_access</span><span class="o">&lt;</span><span class="n">access</span><span class="p">::</span><span class="n">mode</span><span class="p">::</span><span class="n">write</span><span class="o">&gt;</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
<span class="linenos">34</span>      <span class="n">auto</span> <span class="n">a_in</span> <span class="o">=</span> <span class="n">a_buf</span><span class="o">.</span><span class="n">get_access</span><span class="o">&lt;</span><span class="n">access</span><span class="p">::</span><span class="n">mode</span><span class="p">::</span><span class="n">read</span><span class="o">&gt;</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
<span class="linenos">35</span>      <span class="n">auto</span> <span class="n">b_in</span> <span class="o">=</span> <span class="n">b_buf</span><span class="o">.</span><span class="n">get_access</span><span class="o">&lt;</span><span class="n">access</span><span class="p">::</span><span class="n">mode</span><span class="p">::</span><span class="n">read</span><span class="o">&gt;</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
<span class="linenos">36</span>
<span class="linenos">37</span>      <span class="n">h</span><span class="o">.</span><span class="n">parallel_for</span><span class="p">(</span><span class="n">a_size</span><span class="p">,</span>
<span class="linenos">38</span>		     <span class="p">[</span><span class="o">=</span><span class="p">](</span><span class="nb">id</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">idx</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">39</span>		       <span class="n">c_res</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_in</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">b_in</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
<span class="linenos">40</span>		     <span class="p">});</span>
<span class="linenos">41</span>    <span class="p">});</span>
<span class="linenos">42</span><span class="p">}</span>
<span class="linenos">43</span>
<span class="linenos">44</span><span class="nb">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
<span class="linenos">45</span>  <span class="nb">int</span> <span class="n">a</span><span class="p">[</span><span class="n">SIZE</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">SIZE</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="n">SIZE</span><span class="p">];</span>
<span class="linenos">46</span>
<span class="linenos">47</span>  <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">SIZE</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">48</span>    <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
<span class="linenos">49</span>    <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
<span class="linenos">50</span>    <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
<span class="linenos">51</span>  <span class="p">}</span>
<span class="linenos">52</span>
<span class="linenos">53</span>  <span class="n">show_platforms</span><span class="p">();</span>
<span class="linenos">54</span>  <span class="n">vec_add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
<span class="linenos">55</span>
<span class="linenos">56</span>  <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">SIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">57</span>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="linenos">58</span><span class="p">}</span>
</pre></div>
</div>
<p>With the following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Platform</span><span class="p">:</span> <span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="n">FPGA</span> <span class="n">Emulation</span> <span class="n">Platform</span> <span class="k">for</span> <span class="n">OpenCL</span><span class="p">(</span><span class="n">TM</span><span class="p">)</span>
  <span class="n">Device</span><span class="p">:</span> <span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="n">FPGA</span> <span class="n">Emulation</span> <span class="n">Device</span>
<span class="n">Platform</span><span class="p">:</span> <span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="n">OpenCL</span>
  <span class="n">Device</span><span class="p">:</span> <span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="n">Core</span><span class="p">(</span><span class="n">TM</span><span class="p">)</span> <span class="n">i5</span><span class="o">-</span><span class="mi">7300</span><span class="n">U</span> <span class="n">CPU</span> <span class="o">@</span> <span class="mf">2.60</span><span class="n">GHz</span>
<span class="n">Platform</span><span class="p">:</span> <span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="n">CPU</span> <span class="n">Runtime</span> <span class="k">for</span> <span class="n">OpenCL</span><span class="p">(</span><span class="n">TM</span><span class="p">)</span> <span class="n">Applications</span>
  <span class="n">Device</span><span class="p">:</span> <span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="n">Core</span><span class="p">(</span><span class="n">TM</span><span class="p">)</span> <span class="n">i5</span><span class="o">-</span><span class="mi">7300</span><span class="n">U</span> <span class="n">CPU</span> <span class="o">@</span> <span class="mf">2.60</span><span class="n">GHz</span>
<span class="n">Platform</span><span class="p">:</span> <span class="n">SYCL</span> <span class="n">host</span> <span class="n">platform</span>
  <span class="n">Device</span><span class="p">:</span> <span class="n">SYCL</span> <span class="n">host</span> <span class="n">device</span>
<span class="mi">0</span>
<span class="mi">2</span>
<span class="mi">4</span>
<span class="mi">6</span>
<span class="mi">8</span>
<span class="mi">10</span>
<span class="mi">12</span>
<span class="mi">14</span>
<span class="mi">16</span>
<span class="mi">18</span>
</pre></div>
</div>
<p>DPC++ is <a class="reference internal" href="../glossary.html#term-single-source"><span class="xref std std-term">single source</span></a>, which means the <a class="reference internal" href="../glossary.html#term-host-code"><span class="xref std std-term">host code</span></a> and
the <a class="reference internal" href="../glossary.html#term-device-code"><span class="xref std std-term">device code</span></a> can be placed in the same file and compiled
with a single invocation of the compiler.  Therefore, when examining a
DPC++ program, the first step is to understand the delineation between
host code and device code.  DPC++ programs have 3 different scopes.</p>
<ul class="simple">
<li><p><a class="reference internal" href="../glossary.html#term-kernel-scope"><span class="xref std std-term">kernel scope</span></a>: Function that executes on the device</p></li>
<li><p><a class="reference internal" href="../glossary.html#term-command-group-scope"><span class="xref std std-term">command group scope</span></a>: Kernel function and host code to launch
it on the device</p></li>
<li><p><a class="reference internal" href="../glossary.html#term-application-scope"><span class="xref std std-term">application scope</span></a>: Code that executes on the host</p></li>
</ul>
<p>Application scope includes all program lines not in the command group
scope. The application scope is responsible for creating DPC++ queues
that are connected to devices (line 30), allocating data that can be
accessed from the device (lines 26-28), and submit tasks to the queues
(line 32).</p>
<p>Kernel scope is the body of the lambda function found on lines
38-40. Each invocation of the kernel function adds a single element of
the <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> vectors.</p>
<p>Command group scope can be found on lines 32-41. A command group
contains a single kernel function and code to coordinate the passing
of data and control between the host and the device. Lines 33-35
create accessors, which enable the kernel to access the data in the
buffers created on lines 26-28. The <code class="docutils literal notranslate"><span class="pre">parallel_for</span></code> on line 37
launches an instance of the kernel on every element of an index space
and passes the coordinates of the point in the index space to the
function. The index space is defined on line 24. It is a one-dimensional
space that ranges from 0 to 1023.</p>
<p>Now we walk through line by line. Every DPC++ program must include
sycl.hpp (line 2). All types are in the <code class="docutils literal notranslate"><span class="pre">sycl</span></code> namespace and the
line 2 namespace command is a convenience.</p>
<p>Lines 6-21 illustrate the use of the <strong>platform model</strong> by enumerating all
the platforms available on the system and the devices contained in the
platform.</p>
<p>Lines 26-28 and 33-35 show the role of the <strong>memory model</strong>. Device
and host do not access the same memory by default. The memory model
defines the rules for access. Line 45 allocates memory on the host for
the vectors. Lines 26-28 wrap buffers around that memory. Kernels
read/write buffer data via the accessors that are created on lines
33-35. The accessor on line 33 gives the kernel write access to buffer
names as <cite>c_res</cite>, and the accessors on lines 34 &amp; 35 give the
kernel read access to the other buffers.</p>
<p>Lines 30-32 demonstrate the use of the <strong>application execution
model</strong>. A command group is submitted to a queue on line 32. The SYCL
runtime launches the kernel function in the command group on the
device connected to the queue when the requirements of the command
group are met. For this example, the accessors create the requirement
that the buffers be accessible on the device. Queueing the command
group triggers the copying of the data contained in the buffer from
host memory to the device. The runtime launches the kernel when the
data movements complete.</p>
<p>Lines 38-40 illustrate the function of <strong>kernel execution model</strong>. The
<code class="docutils literal notranslate"><span class="pre">parallel_for</span></code> launches an instance of the kernel function for every
point in the index space denoted by <code class="docutils literal notranslate"><span class="pre">a_size</span></code>. The instances are
distributed among the processing elements of the device.</p>
<p>DPC++ uses C++ scopes and object models to
concisely express synchronization. The vectors start in host
memory. When the host memory for the vector is passed to the buffer
constructor on lines 26-28, the buffers take <em>ownership</em> of the host
memory and any use of the original host memory is undefined. When the
destructor for the buffer runs because the containing scope ends, the
runtime ensures that kernel accessing the buffer has ended and syncs
the data back to the original host memory.</p>
<p>The next sections discuss in more details those four models:
Platform model, Execution model, Memory model, and Kernel model.</p>
</section>


              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="index.html" title="previous page">Programming Model</a>
    <a class='right-next' id="next-link" href="platform-model.html" title="next page">Platform Model</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Intel<br/>
        
            &copy; Copyright 2020, Intel.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>